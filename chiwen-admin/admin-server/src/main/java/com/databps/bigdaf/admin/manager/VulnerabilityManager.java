package com.databps.bigdaf.admin.manager;

import com.databps.bigdaf.admin.security.SecurityUtils;
import com.databps.bigdaf.admin.service.HadoopService;
import com.google.gson.JsonObject;
import java.io.IOException;
import org.apache.commons.lang3.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

/**
 * @author shibingxin
 * @create 2017-08-22 下午7:14
 */
@Component
public class VulnerabilityManager {

  @Autowired
  private HadoopService hadoopService;

  public String getConfig(String cmpyId) throws IOException {
    String hdfsUrl = null;
    String hdfsHttpUrl = hadoopService.getHdfsHost(cmpyId);
    if (StringUtils.isNoneBlank(hdfsHttpUrl)) {
      String[] url = hdfsHttpUrl.split("//");
      hdfsUrl = url[1];
    }
    JsonObject json = new JsonObject();
    json.addProperty("ip_port", hdfsUrl);
    json.addProperty("type", 0);
    json.addProperty("name", SecurityUtils.getCurrentUserLogin());
    return json.toString();
  }
}